@model AtletaAsdericel.Models.Atleta
@using AtletaAsdericel.Models.Enum

@{
	ViewBag.Title = "Create";
}
<h2>Cadastro de Atleta</h2>
<hr />
<form  id="formAtleta" class="user" asp-action="Create">
	<input type="hidden" asp-for="Id" />
	<input type="hidden" name="AtletaFederacoes" id="federacoesInput">

	<div class="form-group row mt-4">
		<div class="col-md-3">
			<select asp-for="TipoCadastro" required asp-items="Html.GetEnumSelectList<ETipoCadastro>()"
					class="form-control rounded-pill">
				<option value="">Selecione o tipo de cadastro ...</option>
			</select>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Nome class="form-control form-control-user" required placeholder="Nome">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=NomeSocial class="form-control form-control-user" placeholder="Nome Social">
		</div>
		<div class="col-md-3 ">
			<input type="text" asp-for=NomeConhecido class="form-control form-control-user" placeholder="Nome Conhecido">
		</div>
	</div>

	<div class="form-group row">
		<div class="col-md-3">
			<select asp-for="EstadoCivil" type="text" asp-items="Html.GetEnumSelectList<EStadoCivil>()" class="form-control rounded-pill" required placeholder="Selecione">
				<option value="">Selecione o estado civil ...</option>
			</select>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for="DataNascimento" class="form-control form-control-user date" required placeholder="Data de Nascimento"
				   value="@(Model.DataNascimento != DateTime.MinValue ? Model.DataNascimento.ToString("dd/MM/yyyy") : string.Empty)">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=CIN_RG class="form-control form-control-user" required placeholder="CIN/RG">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=OrgaoEmissor class="form-control form-control-user " placeholder="Orgão emissor">
		</div>
	</div>
	<div class="form-group row">
		<div class="col-md-3">
			<input type="text" asp-for="DataExpedicao" class="form-control form-control-user dtExpedicao" required placeholder="Data de Expedição"
				   value="@(Model.DataExpedicao != DateTime.MinValue ? Model.DataExpedicao.ToString("dd/MM/yyyy") : string.Empty)">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=CPF class="form-control form-control-user cpf" required placeholder="Cpf">
		</div>

		<div class="col-md-3">
			<input type="text" asp-for=NumeroSUS class="form-control form-control-user " required placeholder="Numero do Sus">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Passaporte class="form-control form-control-user " placeholder=" Nº Passaporte">
		</div>
	</div>

	<div class="form-group row">

		<div class="col-md-3">
			<select asp-for="Sexo" type="text" asp-items="Html.GetEnumSelectList<ESexo>()" class="form-control rounded-pill" required placeholder="Selecione">
				<option value="">Selecione o sexo ...</option>
			</select>
		</div>
		<div class="col-md-3">
			<select asp-for="TipoSanguineo" type="text" asp-items="Html.GetEnumSelectList<ETipoSanguineo>()" class="form-control rounded-pill" placeholder="Selecione">
				<option value="">Selecione o Tipo Sanguíneo ...</option>
			</select>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Profissao class="form-control form-control-user " placeholder="Profissão">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for="Mae" class="form-control form-control-user " required placeholder="Nome da mãe">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for="Pai" class="form-control form-control-user" placeholder="Nome do Pai">
		</div>
	</div>

	<hr />
	<label>Dados endereço</label>
	<div class="form-group row">
		<div class="col-md-3">
			<input type="text" asp-for="Endereco.Cep" class="form-control form-control-user" required placeholder="Cep">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Endereco.Logradouro class="form-control form-control-user" placeholder="Rua">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Endereco.Bairro class="form-control form-control-user" placeholder="Bairro">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Endereco.Numero required class="form-control form-control-user" placeholder="Número">
		</div>
	</div>
	<div class="form-group row">
		<div class="col-md-3">
			<input type="text" asp-for=Endereco.Localidade class="form-control form-control-user" placeholder="Cidade">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Endereco.Uf class="form-control form-control-user" placeholder="Estado">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Endereco.Pais class="form-control form-control-user" placeholder="País" required>
		</div>
	</div>
	<hr />
	<label>Dados Instituição</label>
	<div class="form-group row">
		<div class="col-md-3">
			<select asp-for="Ensino" type="text" asp-items="Html.GetEnumSelectList<EEnsino>()" class="form-control rounded-pill" placeholder="Selecione">
				<option value="">Selecione o nível de ensino...</option>
			</select>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for="Escola.Nome" class="form-control form-control-user" placeholder="Instituição de ensino" required>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Escola.INEP class="form-control form-control-user" placeholder="Código INEP">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Escola.Telefone class="form-control form-control-user" placeholder="Telefone da instituição">
		</div>
	</div>
	<div class="form-group row">
		<div class="col-md-3">
			<input type="text" asp-for=Escola.Municipio class="form-control form-control-user" placeholder="Município" required>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Escola.Estado class="form-control form-control-user" placeholder="Estado" required>
		</div>
	</div>
	<hr />
	<label>Dados da Modalidade</label>
	<div class="form-group row">
		<div class="col-md-3">
			<select asp-for="AtletaModalidades" asp-items="Model.modalidades" id="Select_ModalidadesId" class="form-control rounded-pill select2"
					placeholder="Selecione">
				<option value="">Selecione a modalidade ...</option>
			</select>
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Peso required class="form-control form-control-user" placeholder="Peso">
		</div>
		<div class="col-md-3">
			<input type="text" asp-for=Altura required class="form-control form-control-user" placeholder="Altura">
		</div>
		<div class="col-md-3">
			<select asp-for="Camisa" type="text" asp-items="Html.GetEnumSelectList<ECamisa>()" class="form-control rounded-pill" placeholder="Selecione">
				<option value="">Selecione o tamanho da Camisa ...</option>
			</select>
		</div>
		<div class="col-md-3">
			<select asp-for="Calca" type="text" asp-items="Html.GetEnumSelectList<ECalca>()" class="form-control rounded-pill" placeholder="Selecione">
				<option value="">Selecione o tamanho da Calça ...</option>
			</select>
		</div>
	</div>
	<hr />
	<label>Dados Federação</label>

		<div class="form-group row">
			<div class="col-md-3">
				<select id="selectFederacao" class="form-control">
					<option value="">Selecione a Federação...</option>
					@foreach (var federacao in Model.federacoes)
					{
						<option value="@federacao.Value">@federacao.Text</option>
					}
				</select>
			</div>
			<div class="col-md-3">
				<input type="text" id="numeroRegistro" class="form-control" placeholder="Digite o número de registro">
			</div>
		</div>

		<button type="button" class="btn btn-primary mt-2" id="addFederacao">Adicionar</button>

	<h5 class="mt-3">Federações Adicionadas</h5>
	<ul id="listaFederacoes" class="list-group"></ul>
	<hr />

	<button type="submit" class="btn btn-primary btn-user btn-block ">
		Gravar
	</button>
</form>

<div>
	@Html.ActionLink("Voltar para Lista", "Index")
</div>

@*@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}*@
<script>
		$(document).ready(function () {
		$('#Endereco_Cep').on('input', function () {
			$(this).val($(this).val().replace(/\D/g, '')); // Remove todos os caracteres não numéricos
		});
	});
		document.getElementById("formAtleta").addEventListener("submit", function () {
		document.getElementById("federacoesInput").value = JSON.stringify(federacoesSelecionadas);
	});

		$(document).ready(function () {
			$('#Endereco_Cep').on('blur', function () {
				// Pega o valor do campo de CEP
				const cep = this.value;

				$.getJSON(`https://viacep.com.br/ws/${cep}/json/`, function (data) {
					// Atualiza os campos de endereço se a busca retornar com sucesso
					if (!data.erro) {
						$('#Endereco_Bairro').val(data.bairro);
						$('#Endereco_Logradouro').val(data.logradouro);
						$('#Endereco_Localidade').val(data.localidade);
						$('#Endereco_Uf').val(data.uf);
					} else {
						alert("Endereco não encontrado")
						// Limpa os campos de endereço se o CEP não for encontrado
						$('#Endereco_Bairro').val('');
						$('#Endereco_Logradouro').val('');
						$('#Endereco_Localidade').val('');
						$('#Endereco_Estado').val('');
					}
				});
			});

			   $('#Select_ModalidadesId, #Select_InstituicaoIds').multiselect({
			nonSelectedText: "Selecione...",
			buttonWidth: '100%',
		});
		});


</script>
<script>
	let federacoesSelecionadas = [];

	document.getElementById("addFederacao").addEventListener("click", function () {
		let select = document.getElementById("selectFederacao");
		let numeroInput = document.getElementById("numeroRegistro");
		let lista = document.getElementById("listaFederacoes");

		let federacaoId = select.value;
		let federacaoNome = select.options[select.selectedIndex].text;
		let numeroRegistro = numeroInput.value.trim();

		if (!federacaoId || !numeroRegistro) {
			alert("Selecione uma federação e digite o número de registro!");
			return;
		}

		// Evitar duplicatas
		if (federacoesSelecionadas.some(f => f.id === federacaoId)) {
			alert("Esta federação já foi adicionada!");
			return;
		}

		// Adiciona ao array para envio posterior
		federacoesSelecionadas.push({ FederacaoId: federacaoId, NumeroRegistro: numeroRegistro });

		// Adiciona à lista visual
		let listItem = document.createElement("li");
		listItem.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center");
		listItem.innerHTML = `
			${federacaoNome} - ${numeroRegistro}
			<button class="btn btn-danger btn-sm removeFederacao">Remover</button>
		`;

		// Adiciona evento para remover item da lista
		listItem.querySelector(".removeFederacao").addEventListener("click", function () {
			listItem.remove();
			federacoesSelecionadas = federacoesSelecionadas.filter(f => f.id !== federacaoId);
		});

		lista.appendChild(listItem);

		// Limpar os campos
		select.value = "";
		numeroInput.value = "";
	});
</script>
